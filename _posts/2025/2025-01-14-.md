---
title: JS 中的链式调用
categories: [javascript, ecmascript]
author: iugo
date: 2025-01-14
last_modified_at: 2025-01-14 12:01+08:00
---

## 数组中的链式调用

```ts
const numbers = [1, 2, 3, 4, 5];
const result = numbers
  .filter(n => n % 2 === 0) // 过滤偶数
  .map(n => n * 2) // 每个数乘以2
  .reduce((sum, n) => sum + n, 0); // 求和
```

但是仅限于数组, 如果想要在其他对象上实现链式调用, 就需要自定义方法.

## 对象方法链式调用

```ts
class Calculator {
  constructor() {
    this.value = 0;
  }
  add(n) {
    this.value += n;
    return this;
  }

  multiply(n) {
    this.value *= n;
    return this;
  }

  getValue() {
    return this.value;
  }
}

const calc = new Calculator();
const result = calc
  .add(5)
  .multiply(2)
  .add(3)
  .getValue(); // 13
```

但是需要额外新增对象, 并且许多时候函数作为方法并不合适.

## Promise 中的链式调用

```ts
await Promise.resolve(1)
  .then(x => x + 1)
  .then(x => x * 2)
  .then(x => console.log(x)); // 4
```

目前这是我最常用的方法.

## JS Pipe Operator (管道操作符) 提案

<https://github.com/tc39/proposal-pipeline-operator>

参考了几种语言的语法:

1. Hack
2. F#

另外, 许多其他语言也有类似语法, 比如 Elixir.
