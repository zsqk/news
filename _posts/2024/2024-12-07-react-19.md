---
title: React 19
categories: [react]
author: iugo
---

React 19 ç»ˆäºæ­£å¼å‘å¸ƒäº†: <https://react.dev/blog/2024/12/05/react-19>

æ–°ç‰ˆæœ¬ä¸­æ–°å¢äº†è®¸å¤šåŠŸèƒ½, å…¶ä¸­, ä¸€äº›åŠŸèƒ½æ˜¯æˆ‘ä»¬é‡ç‚¹å…³æ³¨çš„:

1. `useActionState`
2. `use`
3. `useOptimistic`
4. `ref` ä½œä¸º props ä¼ é€’

## useActionState

åœ¨ä½¿ç”¨ useActionState çš„æ—¶å€™, æˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯, åœ¨å‡½æ•°å†…éƒ¨èƒ½å¦è°ƒç”¨ setState
å‡½æ•°å¯¹æ•°æ®è¿›è¡Œéƒ¨åˆ†ä¿®æ”¹.

å®˜æ–¹æ¼”ç¤ºéå¸¸æ¸…æ™°, è¿™é‡Œç¨ä½œä¿®æ”¹:

```tsx
function DataTable({ name }) {
  const [result, updateData, isPending] = useActionState(
    async (previousState, name) => {
      const result = await getDataPromise(name);
      return result;
    },
    new Result(),
  );

  return (
    <>
      <Table data={result} isPending={isPending} />
      <button
        type="submit"
        disabled={isPending}
        onClick={() => {
          updateData(name);
        }}
      >
        Update
      </button>
    </>
  );
}
```

## use

use ä»ç„¶ä¸æ˜¯ä¸€å®šè¶³å¤Ÿå¯é çš„åŠŸèƒ½. ä¹‹å‰ React å›¢é˜Ÿå°±è¯´äº† use çš„å±€é™æ€§, ç°åœ¨
React 19 ä»ç„¶æ²¡æœ‰è§£å†³è¿™ä¸ªé—®é¢˜.

æˆ‘ä»¬é¢„æœŸä»…åœ¨åˆå§‹åŒ–æ•°æ®çš„æ—¶å€™ä½¿ç”¨ use, åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™ä»ä½¿ç”¨ useState.
åœ¨ç»„ä»¶ä¸­, åŒæ—¶ä¿æœ‰è¿™ä¸¤ç§çŠ¶æ€ç®¡ç†çš„æ–¹å¼, æ¯”å¦‚:

```tsx
function MyComponent() {
  const initData = use(getDataPromise());
  // ğŸ‘† å› ä¸ºç°åœ¨ä¸èƒ½åœ¨æ¸²æŸ“ç»„ä»¶ä¸­åˆ›å»º Promise, æ‰€ä»¥ç°åœ¨ä¼šæŠ¥é”™
  const [data, setData] = useState<Data | null>(null);
  const currentData = useMemo(() => data ?? initData, [data, initData]);

  return (
    <>
      {currentData}
      <button
        onClick={async () => {
          const data = await getDataPromise();
          setData(data);
        }}
      >
        Set Data
      </button>
    </>
  );
}
```

ä¸è¿‡, å¦‚ä½•æˆ‘ä»¬åŒºåˆ†åˆå§‹åŒ–æ•°æ®å’Œæ›´æ–°æ•°æ®, ä»…åœ¨ç³»ç»Ÿåˆå§‹åŒ–æ•°æ®çš„æ—¶å€™ä½¿ç”¨ use,
é‚£ä¹ˆ use ä»ç„¶æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åŠŸèƒ½. æ¯”å¦‚:

```tsx
const configPromise = getConfigPromise();

function MyComponent() {
  const config = use(configPromise);
  const [data, setData] = useState<Data | null>(null);

  return (
    <>
      {data}
      <button
        onClick={async () => {
          const data = await getDataPromise(config);
          setData(data);
        }}
      >
        Set Data
      </button>
    </>
  );
}
```

## useOptimistic

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, æˆ‘ä»¬åŒºåˆ†äº† initData, data å’Œ currentData. åœ¨ React 19 ä¸­,
æˆ‘ä»¬ä½¿ç”¨ useOptimistic å¯ä»¥å¯¹å‰ç«¯é¢„è®¡ä¿®æ”¹æˆåŠŸçš„æ•°æ®è¿›è¡Œä¼˜åŒ–. æ¯”å¦‚:

```tsx
function MyComponent() {
  const [data, setData] = useState<Data | null>(null);
  const [currentData, setOptimisticData] = useOptimistic(data);

  return (
    <>
      {currentData}
      <button
        onClick={async () => {
          setOptimisticData(tempData);
          const data = await getDataPromise(tempData);
          setData(data);
        }}
      >
        Set Data
      </button>
    </>
  );
}
```

åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹, è¿™æ˜¯ä¸€ä¸ªçº¯ä¼˜åŒ–, å¹¶ä¸ä¼šåŠŸèƒ½æœ‰å½±å“.

è¿™ç§ä¼˜åŒ–ç”šè‡³è¿˜æœ‰è´Ÿé¢æ•ˆæœ, æ¯”å¦‚:

1. å¦‚æœç”¨æˆ·åœ¨ç‚¹å‡»æŒ‰é’®ä¹‹å, å·²ç»æ¸²æŸ“äº†æ–°çš„æ•°æ®, è¿™æ—¶ç”¨æˆ·è®¤ä¸ºå·²ç»å®Œæˆ.
2. ç„¶å, å¦‚æœåç«¯æ•°æ®æ›´æ–°å¤±è´¥, é‚£ä¹ˆæ•°æ®ä¼šé‡ç½®å›é”™è¯¯ä¹‹å‰çš„æ•°æ®, ä½†ç”¨æˆ·ä¸ä¸€å®šä¼šæ³¨æ„åˆ°.

## ref ä½œä¸º props ä¼ é€’

ä¹‹å‰, ref ä½œä¸º props ä¼ é€’çš„æ—¶å€™æ—¶ä¼šæŠ¥é”™. éœ€è¦ä½¿ç”¨ forwardRef æ¥ä¼ é€’.
ä½†æ˜¯, ç°åœ¨ React 19 ä¸­, ä¸å†éœ€è¦ä½¿ç”¨ forwardRef æ¥ä¼ é€’, å¯ä»¥ç›´æ¥ä¼ é€’ ref.

å®˜æ–¹æ¼”ç¤ºä¸º:

```tsx
function MyInput({placeholder, ref}) {
  return <input placeholder={placeholder} ref={ref} />
}

//...
<MyInput ref={ref} />
```
